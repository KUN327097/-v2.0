<!DOCTYPE html>
<html lang="zh-CN" class="h-full bg-slate-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交互式系统架构浏览器 - GEM Workbench</title>
    <!-- Chosen Palette: Slate & Sky -->
    <!-- Application Structure Plan: A step-by-step interactive simulation is chosen to explain a complex process. The user controls the flow via 'Next'/'Previous' buttons, making it a self-paced learning tool. The layout features a central diagram with components (Frontend, Firebase Services) and a side panel for narrative explanations. This structure is optimal for educational content, as it pairs visual animation with textual context, reinforcing the relationship between system components at each stage of the user journey. -->
    <!-- Visualization & Content Choices: 
        - System Components -> Goal: Organize -> Viz: Styled HTML blocks with icons -> Interaction: Blocks are highlighted and animated based on the current step. -> Justification: Clear visual separation of concerns.
        - Data Flow -> Goal: Show Relationships/Change -> Viz: Animated 'data packet' divs using CSS transitions -> Interaction: The packets physically move from one component to another as the user progresses. -> Justification: This directly visualizes the data flow described in the architecture diagram, making the abstract concept of API calls and data writes tangible.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .component-box {
            transition: all 0.5s ease-in-out;
            border: 2px solid transparent;
        }
        .component-box.highlight {
            border-color: #0ea5e9; /* sky-500 */
            transform: scale(1.03);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .data-packet {
            position: absolute;
            opacity: 0;
            transition: all 1.2s cubic-bezier(0.5, 0, 0.5, 1);
            transform-origin: center;
            z-index: 10;
        }
        .arrow {
            position: absolute;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            z-index: 5;
        }
        .arrow-line {
            position: absolute;
            background-color: #64748b; /* slate-500 */
            transform-origin: left center;
        }
        .arrow-head {
            position: absolute;
            border-style: solid;
            border-color: transparent transparent transparent #64748b;
        }
    </style>
</head>
<body class="h-full antialiased text-slate-800">

    <div class="min-h-screen p-4 sm:p-6 lg:p-8 flex flex-col">
        <header class="w-full max-w-7xl mx-auto mb-6 text-center">
            <h1 class="text-2xl sm:text-3xl font-bold tracking-tight text-slate-900">GEM项目架构浏览器</h1>
            <p class="text-sm text-slate-500 mt-1">一个交互式的指南，用于理解前端、数据库和后端的关系</p>
        </header>

        <main class="w-full max-w-7xl mx-auto flex-grow flex flex-col lg:flex-row gap-8">
            
            <!-- Left Panel: Explanation & Controls -->
            <div class="w-full lg:w-1/3 xl:w-1/4 bg-white p-6 rounded-2xl border border-slate-200 shadow-sm flex flex-col">
                <div class="flex-grow">
                    <h2 id="step-title" class="text-xl font-semibold text-sky-700 mb-2">欢迎！</h2>
                    <div id="step-description" class="text-sm text-slate-600 space-y-3">
                        <p>本浏览器将通过模拟一次完整的“创建评测任务”流程，带您了解我们项目中各个技术组件是如何协同工作的。</p>
                        <p>请点击“下一步”开始您的旅程。</p>
                    </div>
                </div>
                <div class="mt-6 pt-6 border-t border-slate-200">
                    <div class="flex justify-between items-center">
                        <button id="prev-btn" onclick="changeStep(-1)" class="text-sm font-medium text-slate-500 hover:text-slate-800 disabled:opacity-50 disabled:cursor-not-allowed" disabled>&larr; 上一步</button>
                        <span id="step-counter" class="text-xs text-slate-400">0 / 6</span>
                        <button id="next-btn" onclick="changeStep(1)" class="bg-sky-600 text-white font-medium px-5 py-2 rounded-lg shadow-sm hover:bg-sky-700 transition disabled:bg-slate-400">下一步 &rarr;</button>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Interactive Diagram -->
            <div id="diagram-container" class="w-full lg:w-2/3 xl:w-3/4 bg-white p-6 sm:p-8 rounded-2xl border border-slate-200 shadow-sm relative min-h-[60vh] lg:min-h-0">
                
                <!-- Components -->
                <div id="frontend" class="component-box absolute top-1/2 -translate-y-1/2 left-8 w-48 h-32 bg-slate-100 p-4 rounded-lg flex flex-col justify-center items-center">
                    <span class="text-3xl">💻</span>
                    <p class="font-bold mt-2">前端 (用户界面)</p>
                    <p class="text-xs text-slate-500">HTML/CSS/JS</p>
                </div>

                <div class="absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 flex flex-col items-center gap-8">
                    <div id="auth" class="component-box w-48 h-24 bg-rose-50 p-3 rounded-lg flex flex-col justify-center items-center">
                        <span class="text-2xl">🔑</span>
                        <p class="font-bold mt-1 text-center">用户认证</p>
                        <p class="text-xs text-slate-500">Authentication</p>
                    </div>
                    <div id="firestore" class="component-box w-56 h-36 bg-amber-50 p-4 rounded-lg flex flex-col justify-center items-center">
                        <span class="text-3xl">🗃️</span>
                        <p class="font-bold mt-2 text-center">数据库 (存储)</p>
                        <p class="text-xs text-slate-500">Firestore</p>
                    </div>
                </div>
                
                <div id="functions" class="component-box absolute top-1/4 right-8 w-48 h-32 bg-indigo-50 p-4 rounded-lg flex flex-col justify-center items-center">
                    <span class="text-3xl">⚙️</span>
                    <p class="font-bold mt-2">后端逻辑</p>
                    <p class="text-xs text-slate-500">Cloud Functions</p>
                </div>

                <div id="llm-api" class="component-box absolute bottom-1/4 right-8 w-48 h-32 bg-teal-50 p-4 rounded-lg flex flex-col justify-center items-center">
                    <span class="text-3xl">🧠</span>
                    <p class="font-bold mt-2 text-center">外部AI模型</p>
                    <p class="text-xs text-slate-500">LLM APIs</p>
                </div>

                <!-- Data Packets -->
                <div id="packet-uid" class="data-packet w-10 h-10 bg-rose-200 border-2 border-rose-500 rounded-full flex justify-center items-center text-xs font-bold">UID</div>
                <div id="packet-task" class="data-packet w-10 h-10 bg-amber-200 border-2 border-amber-500 rounded-lg flex justify-center items-center">📝</div>
                <div id="packet-trigger" class="data-packet w-10 h-10 bg-indigo-200 border-2 border-indigo-500 rounded-full flex justify-center items-center animate-pulse">⚡</div>
                <div id="packet-query" class="data-packet w-10 h-10 bg-teal-200 border-2 border-teal-500 rounded-lg flex justify-center items-center">❓</div>
                <div id="packet-result" class="data-packet w-10 h-10 bg-indigo-200 border-2 border-indigo-500 rounded-lg flex justify-center items-center">📊</div>
                <div id="packet-update" class="data-packet w-10 h-10 bg-sky-200 border-2 border-sky-500 rounded-full flex justify-center items-center text-sm">🔄</div>
                
            </div>
        </main>
    </div>

<script>
const STEPS = [
    {
        title: "欢迎！",
        description: "<p>本浏览器将通过模拟一次完整的“创建评测任务”流程，带您了解我们项目中各个技术组件是如何协同工作的。</p><p>请点击“下一步”开始您的旅程。</p>",
        action: (elements) => {}
    },
    {
        title: "第一步: 用户认证",
        description: "<p>当用户访问我们的应用时，前端会做的第一件事就是向 <strong>Firebase Authentication</strong> 请求一个匿名的用户身份。</p><p>成功后，Authentication服务会返回一个独一无二的用户ID (UID)，这个UID就像是用户在本次会话中的“身份证”，用于后续所有操作。</p>",
        action: (elements) => {
            elements.frontend.classList.add('highlight');
            elements.auth.classList.add('highlight');
            
            const from = elements.auth;
            const to = elements.frontend;
            const packet = elements.packets.uid;

            packet.style.top = `${from.offsetTop + from.offsetHeight / 2 - packet.offsetHeight / 2}px`;
            packet.style.left = `${from.offsetLeft + from.offsetWidth / 2 - packet.offsetWidth / 2}px`;
            packet.style.opacity = '1';
            
            setTimeout(() => {
                packet.style.top = `${to.offsetTop + to.offsetHeight / 2 - packet.offsetHeight / 2}px`;
                packet.style.left = `${to.offsetLeft + to.offsetWidth - packet.offsetWidth / 2}px`;
            }, 100);
        }
    },
    {
        title: "第二步: 创建评测任务",
        description: "<p>用户在前端界面上选择好要评测的模型，然后点击“开始评测”按钮。</p><p>前端会将这次任务的所有信息（比如选了哪些模型、状态是什么等）打包成一个数据对象，然后通过SDK将它写入到我们的核心数据库 <strong>Firestore</strong> 中。这相当于创建了一张新的“任务单”。</p>",
        action: (elements) => {
            elements.frontend.classList.add('highlight');
            elements.firestore.classList.add('highlight');

            const from = elements.frontend;
            const to = elements.firestore;
            const packet = elements.packets.task;
            
            packet.style.top = `${from.offsetTop + from.offsetHeight / 2 - packet.offsetHeight / 2}px`;
            packet.style.left = `${from.offsetLeft + from.offsetWidth - packet.offsetWidth / 2}px`;
            packet.style.opacity = '1';

            setTimeout(() => {
                packet.style.top = `${to.offsetTop + to.offsetHeight / 2 - packet.offsetHeight / 2}px`;
                packet.style.left = `${to.offsetLeft - packet.offsetWidth / 2}px`;
            }, 100);
        }
    },
    {
        title: "第三步: 触发后端逻辑",
        description: "<p>Firestore非常强大，它可以被配置为：<strong>当有新数据写入时，自动触发一个动作</strong>。</p><p>我们正是利用了这个特性。当上一步的“任务单”被创建时，Firestore会自动“通知”我们的后端逻辑 <strong>Cloud Function</strong>，并把任务数据传递给它。这个过程是全自动的，无需前端干预。</p>",
        action: (elements) => {
            elements.firestore.classList.add('highlight');
            elements.functions.classList.add('highlight');

            const from = elements.firestore;
            const to = elements.functions;
            const packet = elements.packets.trigger;

            packet.style.top = `${from.offsetTop - from.offsetHeight / 4 - packet.offsetHeight / 2}px`;
            packet.style.left = `${from.offsetLeft + from.offsetWidth - packet.offsetWidth / 2}px`;
            packet.style.opacity = '1';

            setTimeout(() => {
                packet.style.top = `${to.offsetTop + to.offsetHeight / 2 - packet.offsetHeight / 2}px`;
                packet.style.left = `${to.offsetLeft - packet.offsetWidth / 2}px`;
            }, 100);
        }
    },
    {
        title: "第四步: 后端执行评测",
        description: "<p><strong>Cloud Function</strong> 是我们真正的“后台大脑”。它接收到任务后，会开始执行最核心的工作：</p><p>1. 遍历任务中的所有问题。</p><p>2. 拿着这些问题去请求<strong>外部的AI模型API</strong>，获取回答。</p><p>3. (可选) 请求“AI裁判”模型进行打分。这个过程可能需要几分钟，但完全在云端进行，用户可以关闭浏览器。</p>",
        action: (elements) => {
            elements.functions.classList.add('highlight');
            elements.llmApi.classList.add('highlight');
            
            const from = elements.functions;
            const to = elements.llmApi;
            const packet = elements.packets.query;

            packet.style.top = `${from.offsetTop + from.offsetHeight - packet.offsetHeight / 2}px`;
            packet.style.left = `${from.offsetLeft + from.offsetWidth / 2 - packet.offsetWidth / 2}px`;
            packet.style.opacity = '1';

            setTimeout(() => {
                packet.style.top = `${to.offsetTop - packet.offsetHeight / 2}px`;
                packet.style.left = `${to.offsetLeft + to.offsetWidth / 2 - packet.offsetWidth / 2}px`;
                packet.style.transition = 'all 1.2s cubic-bezier(0.5, 0, 0.5, 1), transform 0.5s ease 1.2s';
                packet.style.transform = 'rotate(360deg)';
            }, 100);
        }
    },
    {
        title: "第五步: 结果写回数据库",
        description: "<p>当Cloud Function从AI模型那里拿到了所有的回答和评分后，它会把这些宝贵的结果数据，再写回到 <strong>Firestore</strong> 中那张原始的“任务单”里，并把任务状态更新为“已完成”。</p><p>至此，一次评测的核心流程在后端就已经全部完成了。</p>",
        action: (elements) => {
            elements.functions.classList.add('highlight');
            elements.firestore.classList.add('highlight');
            
            const from = elements.functions;
            const to = elements.firestore;
            const packet = elements.packets.result;

            packet.style.top = `${from.offsetTop + from.offsetHeight / 2 - packet.offsetHeight / 2}px`;
            packet.style.left = `${from.offsetLeft - packet.offsetWidth / 2}px`;
            packet.style.opacity = '1';

            setTimeout(() => {
                packet.style.top = `${to.offsetTop - to.offsetHeight/4 - packet.offsetHeight / 2}px`;
                packet.style.left = `${to.offsetLeft + to.offsetWidth - packet.offsetWidth/2}px`;
            }, 100);
        }
    },
    {
        title: "第六步: 实时更新前端",
        description: "<p>最神奇的一步来了！前端从一开始就正在“监听”着Firestore里任务单的变化。</p><p>当后端Cloud Function将任务状态更新为“已完成”时，Firestore会**立即、自动地将这个更新推送给前端**。前端收到通知后，会自动刷新界面，比如把“处理中”的标签变成“已完成”，并点亮“查看报告”按钮。整个过程是实时的，用户无需手动刷新页面。</p>",
        action: (elements) => {
            elements.firestore.classList.add('highlight');
            elements.frontend.classList.add('highlight');
            
            const from = elements.firestore;
            const to = elements.frontend;
            const packet = elements.packets.update;

            packet.style.top = `${from.offsetTop + from.offsetHeight/2 - packet.offsetHeight / 2}px`;
            packet.style.left = `${from.offsetLeft - packet.offsetWidth/2}px`;
            packet.style.opacity = '1';

            setTimeout(() => {
                packet.style.top = `${to.offsetTop + to.offsetHeight / 2 - packet.offsetHeight / 2}px`;
                packet.style.left = `${to.offsetLeft + to.offsetWidth - packet.offsetWidth / 2}px`;
            }, 100);
        }
    }
];

let currentState = {
    step: 0,
    elements: {
        frontend: document.getElementById('frontend'),
        auth: document.getElementById('auth'),
        firestore: document.getElementById('firestore'),
        functions: document.getElementById('functions'),
        llmApi: document.getElementById('llm-api'),
        packets: {
            uid: document.getElementById('packet-uid'),
            task: document.getElementById('packet-task'),
            trigger: document.getElementById('packet-trigger'),
            query: document.getElementById('packet-query'),
            result: document.getElementById('packet-result'),
            update: document.getElementById('packet-update'),
        },
        title: document.getElementById('step-title'),
        description: document.getElementById('step-description'),
        counter: document.getElementById('step-counter'),
        prevBtn: document.getElementById('prev-btn'),
        nextBtn: document.getElementById('next-btn'),
    }
};

function resetState() {
    Object.values(currentState.elements).forEach(el => {
        if (el && el.classList && el.classList.contains('component-box')) {
            el.classList.remove('highlight');
        }
    });
    Object.values(currentState.elements.packets).forEach(packet => {
        packet.style.opacity = '0';
        packet.style.transform = 'rotate(0deg)';
        packet.style.transition = 'all 1.2s cubic-bezier(0.5, 0, 0.5, 1)';
    });
}

function updateUI() {
    const stepData = STEPS[currentState.step];
    
    resetState();

    currentState.elements.title.innerHTML = stepData.title;
    currentState.elements.description.innerHTML = stepData.description;
    currentState.elements.counter.textContent = `${currentState.step} / ${STEPS.length - 1}`;
    
    currentState.elements.prevBtn.disabled = currentState.step === 0;
    currentState.elements.nextBtn.disabled = currentState.step === STEPS.length - 1;

    if (stepData.action) {
        stepData.action(currentState.elements);
    }
}

function changeStep(direction) {
    const newStep = currentState.step + direction;
    if (newStep >= 0 && newStep < STEPS.length) {
        currentState.step = newStep;
        updateUI();
    }
}

window.onload = updateUI;

</script>
</body>
</html>
